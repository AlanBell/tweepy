<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Authentication Tutorial &mdash; tweepy v1.4 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.4',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="tweepy v1.4 documentation" href="index.html" />
    <link rel="next" title="Code Snippets" href="code_snippet.html" />
    <link rel="prev" title="Getting started" href="getting_started.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="code_snippet.html" title="Code Snippets"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="getting_started.html" title="Getting started"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">tweepy v1.4 documentation</a> &raquo;</li> 
      </ul>
    </div>  
    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  
  <div class="section" id="authentication-tutorial">
<span id="auth-tutorial"></span><h1>Authentication Tutorial<a class="headerlink" href="#authentication-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Tweepy supports both basic and oauth authentication. Authentication is
handled by tweepy.AuthHandler classes with two implementations
provided:</p>
<ul class="simple">
<li>OAuthHandler</li>
<li>BasicAuthHandler</li>
</ul>
</div>
<div class="section" id="basic-authentication">
<h2>Basic Authentication<a class="headerlink" href="#basic-authentication" title="Permalink to this headline">¶</a></h2>
<p>Basic authentication uses the user&#8217;s Twitter username and password for
authenticating with the API. You must query the user for these two
pieces of infomation before we can authenticate.</p>
<p>Now first we must create an instance of the BasicAuthHandler and pass
into it the username and password:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">auth</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">BasicAuthHandler</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
</pre></div>
</div>
<p>Next we need to create our API instance which will be used for
executing requests to the Twitter API:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">api</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">API</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>
</pre></div>
</div>
<p>We are now ready to make API calls that are authenticated! Here is a
quick example posting a new tweet to the authenticated user&#8217;s account:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">api</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="s">&#39;hello from tweepy!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="oauth-authentication">
<h2>OAuth Authentication<a class="headerlink" href="#oauth-authentication" title="Permalink to this headline">¶</a></h2>
<p>OAuth is a bit trickier than basic auth, but there are some advantages
to using it:</p>
<ul class="simple">
<li>You can set a &#8216;from myappname&#8217; which will appear in tweets
posted</li>
<li>More secure since you don&#8217;t need the user&#8217;s password</li>
<li>Your app does not break if the user changes their password in
the future</li>
</ul>
<p>Tweepy tries to make OAuth as painless as possible for you. To begin
the process we need to register our client application with
Twitter. You can do that here. Create a new application and once you
are done you should have your consumer token and secret. Keep these
two handy, you&#8217;ll need them.</p>
<p>The next step is creating an OAuthHandler instance. Into this we pass
our consumer token and secret which was given to us in the previous
paragraph:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">auth</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">OAuthHandler</span><span class="p">(</span><span class="n">consumer_token</span><span class="p">,</span> <span class="n">consumer_secret</span><span class="p">)</span>
</pre></div>
</div>
<p>If you have a web application and are using a callback URL that needs
to be supplied dynamically you would pass it in like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">auth</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">OAuthHandler</span><span class="p">(</span><span class="n">consumer_token</span><span class="p">,</span> <span class="n">consumer_secret</span><span class="p">,</span>
<span class="n">callback_url</span><span class="p">)</span>
</pre></div>
</div>
<p>If the callback URL will not be changing, it is best to just configure
it statically on twitter.com when setting up your application&#8217;s
profile.</p>
<p>Unlike basic auth, we must do the OAuth &#8220;dance&#8221; before we can start
using the API. We must complete the following steps:</p>
<ol class="arabic simple">
<li>Get a request token from twitter</li>
<li>Redirect user to twitter.com to authorize our application</li>
<li>If using a callback, twitter will redirect the user to
us. Otherwise the user must manually supply us with the verifier
code.</li>
<li>Exchange the authorized request token for an access token.</li>
</ol>
<p>So let&#8217;s fetch our request token to begin the dance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
    <span class="n">redirect_url</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">get_authorization_url</span><span class="p">()</span>
<span class="k">except</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">TweepError</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;Error! Failed to get request token.&#39;</span>
</pre></div>
</div>
<p>This call requests the token from twitter and returns to us the
authorization URL where the user must be redirect to authorize us. Now
if this is a desktop application we can just hang onto our
OAuthHandler instance until the user returns back. In a web
application we will be using a callback request. So we must store the
request token in the session since we will need it inside the callback
URL request. Here is a pseudo example of storing the request token in
a session:</p>
<div class="highlight-python"><pre>session.set('request_token', (auth.request_token.key,
auth.request_token.secret)</pre>
</div>
<p>So now we can redirect the user to the URL returned to us earlier from
the get_authorization_url() method.</p>
<p>If this is a desktop application (or any application not using
callbacks) we must query the user for the &#8220;verifier code&#8221; that twitter
will supply them after they authorize us. Inside a web application
this verifier value will be supplied in the callback request from
twitter as a GET query parameter in the URL.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Example using callback (web app)</span>
<span class="n">verifier</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;oauth_verifier&#39;</span><span class="p">)</span>

<span class="c"># Example w/o callback (desktop)</span>
<span class="n">verifier</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;Verifier:&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The final step is exchanging the request token for an access
token. The access token is the &#8220;key&#8221; for opening the Twitter API
treasure box. To fetch this token we do the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Let&#39;s say this is a web app, so we need to re-build the auth handler</span>
<span class="c"># first...</span>
<span class="n">auth</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">OAuthHandler</span><span class="p">(</span><span class="n">consumer_key</span><span class="p">,</span> <span class="n">consumer_secret</span><span class="p">)</span>
<span class="n">token</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;request_token&#39;</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;request_token&#39;</span><span class="p">)</span>
<span class="n">auth</span><span class="o">.</span><span class="n">set_request_token</span><span class="p">(</span><span class="n">token</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">token</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">auth</span><span class="o">.</span><span class="n">get_access_token</span><span class="p">(</span><span class="n">verifier</span><span class="p">)</span>
<span class="k">except</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">TweepError</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;Error! Failed to get access token.&#39;</span>
</pre></div>
</div>
<p>It is a good idea to save the access token for later use. You do not
need to re-fetch it each time. Twitter currently does not expire the
tokens, so the only time it would ever go invalid is if the user
revokes our application access. To store the access token depends on
your application. Basically you need to store 2 string values: key and
secret:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">auth</span><span class="o">.</span><span class="n">access_token</span><span class="o">.</span><span class="n">key</span>
<span class="n">auth</span><span class="o">.</span><span class="n">access_token</span><span class="o">.</span><span class="n">secret</span>
</pre></div>
</div>
<p>You can throw these into a database, file, or where ever you store
your data. To re-build an OAuthHandler from this stored access token
you would do this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">auth</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">OAuthHandler</span><span class="p">(</span><span class="n">consumer_key</span><span class="p">,</span> <span class="n">consumer_secret</span><span class="p">)</span>
<span class="n">auth</span><span class="o">.</span><span class="n">set_access_token</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">secret</span><span class="p">)</span>
</pre></div>
</div>
<p>So now that we have our OAuthHandler equiped with an access token, we
are ready for business:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">api</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">API</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="s">&#39;tweepy + oauth!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="">Authentication Tutorial</a><ul>
<li><a class="reference external" href="#introduction">Introduction</a></li>
<li><a class="reference external" href="#basic-authentication">Basic Authentication</a></li>
<li><a class="reference external" href="#oauth-authentication">OAuth Authentication</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="getting_started.html" title="previous chapter">Getting started</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="code_snippet.html" title="next chapter">Code Snippets</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/auth_tutorial.txt">Show Source</a></li>
            </ul>
          <h3>Quick search</h3>
            <form class="search" action="search.html" method="get">
              <input type="text" name="q" size="18" /> <input type="submit" value="Go" />
              <input type="hidden" name="check_keywords" value="yes" />
              <input type="hidden" name="area" value="default" />
            </form>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="code_snippet.html" title="Code Snippets"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="getting_started.html" title="Getting started"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">tweepy v1.4 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2009, Joshua Roesslein.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.5.2.
    </div>
  </body>
</html>